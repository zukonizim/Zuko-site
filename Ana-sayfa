<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Exelans Chat</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body { font-family: Arial; padding: 20px; }
  #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 5px; margin-bottom: 10px; }
  #messages p { margin: 5px 0; }
</style>
</head>
<body>
<h1>Exelans Chat</h1>

<div id="authDiv">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Şifre"><br>
  <button onclick="register()">Kayıt Ol</button>
  <button onclick="login()">Giriş Yap</button>
</div>

<div id="chatDiv" style="display:none;">
  <h2>Hoşgeldin <span id="userEmail"></span></h2>
  <div id="messages"></div>
  <input type="text" id="msgInput" placeholder="Mesaj yaz...">
  <button onclick="sendMessage()">Gönder</button>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "exelans-admin.firebaseapp.com",
    projectId: "exelans-admin",
    storageBucket: "exelans-admin.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abcdef"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Kayıt
  function register() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(user => {
        db.collection('users').doc(user.user.uid).set({
          uid: user.user.uid,
          email: email,
          role: "user",
          banned: false
        });
        alert('Kayıt başarılı');
      })
      .catch(err => alert(err.message));
  }

  // Giriş
  function login() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, password)
      .then(user => {
        const uid = user.user.uid;
        db.collection('users').doc(uid).get().then(doc => {
          if(doc.exists && doc.data().banned){
            alert('Banlısınız! Giriş yapılamıyor.');
            auth.signOut();
            return;
          }
          document.getElementById('authDiv').style.display='none';
          document.getElementById('chatDiv').style.display='block';
          document.getElementById('userEmail').innerText = email;
          loadMessages();
        });
      })
      .catch(err => alert(err.message));
  }

  // Mesaj Gönder
  function sendMessage() {
    const text = document.getElementById('msgInput').value;
    const user = auth.currentUser;
    if(!user || text.trim()==="") return;
    db.collection('messages').add({
      uid: user.uid,
      email: user.email,
      text: text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById('msgInput').value='';
  }

  // Mesajları Yükle
  function loadMessages() {
    db.collection('messages').orderBy('timestamp').onSnapshot(snapshot => {
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML='';
      snapshot.forEach(doc => {
        const m = doc.data();
        messagesDiv.innerHTML += `<p><b>${m.email}:</b> ${m.text}</p>`;
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }
</script>
</body>
</html>
